name: Auto Padel Booking

on:
  schedule:
    - cron: "0 0 * * *"  # runs every day at midnight UTC
  workflow_dispatch:      # allows manual run

jobs:
  run-booker:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v3

      - name: Install Node
        uses: actions/setup-node@v3
        with:
          node-version: 20

      - name: Install dependencies
        run: |
          npm install
          npx playwright install --with-deps

      - name: Run padel auto-booker
        env:
          PADELCONNECT_EMAIL: ${{ secrets.PADELCONNECT_EMAIL }}
          PADELCONNECT_PASSWORD: ${{ secrets.PADELCONNECT_PASSWORD }}
          TARGET_VENUE: ${{ secrets.TARGET_VENUE }}
          TARGET_COURT: ${{ secrets.TARGET_COURT }}
          TARGET_START: ${{ secrets.TARGET_START }}
          TARGET_END: ${{ secrets.TARGET_END }}
          TIMEZONE: ${{ secrets.TIMEZONE }}
          LEAD_DAYS: ${{ secrets.LEAD_DAYS }}
          FALLBACK_ENABLE: ${{ secrets.FALLBACK_ENABLE }}
          FALLBACK_WINDOWS: ${{ secrets.FALLBACK_WINDOWS }}
          FALLBACK_COURTS: ${{ secrets.FALLBACK_COURTS }}
          SMTP_HOST: ${{ secrets.SMTP_HOST }}
          SMTP_PORT: ${{ secrets.SMTP_PORT }}
          SMTP_USER: ${{ secrets.SMTP_USER }}
          SMTP_PASS: ${{ secrets.SMTP_PASS }}
          NOTIFY_TO: ${{ secrets.NOTIFY_TO }}

        run: |
          node dist/index.js
